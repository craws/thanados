{"version":3,"file":"telemetryLoaderPlugin.js","sourceRoot":"","sources":["../../../../../sourceES6/viewer/src/loader/plugins/telemetryLoaderPlugin.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,gBAAgB,EAAE,MAAM,iCAAiC,CAAC;AAGnE,OAAO,EAAE,aAAa,EAAE,MAAM,oCAAoC,CAAC;AAEnE;IAAA;IAuCA,CAAC;IAhCU,sCAAM,GAAb,UAAc,MAAoD,EAAE,KAAkB;QAClF,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC,GAAG,CAAC;IACxC,CAAC;IAEM,wCAAQ,GAAf,UAAgB,KAAkB;QAC9B,gBAAgB,CAAC,SAAS,CAAC,cAAc,EAAE,KAAK,CAAC,WAAW,EAAE,EAAE;YAC5D,KAAK,EAAE,KAAK;YACZ,QAAQ,EAAE,aAAa,CAAC,GAAG,GAAG,IAAI,CAAC,UAAU;SAChD,CAAC,CAAC;QACH,gBAAgB,CAAC,gBAAgB,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;IACvF,CAAC;IAEM,uCAAO,GAAd,UAAe,OAAe,EAAE,SAAc;QAC1C,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,GAAG,CAAC;QAClC,gBAAgB,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE;YAChE,KAAK,EAAE,IAAI,CAAC,MAAM;YAClB,QAAQ,EAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU;SAC5C,CAAC,CAAC;QAEH,gBAAgB,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;IACnG,CAAC;IAEM,0CAAU,GAAjB;QACI,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,GAAG,CAAC;QAClC,gBAAgB,CAAC,SAAS,CAAC,eAAe,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE;YACnE,KAAK,EAAE,IAAI,CAAC,MAAM;YAClB,QAAQ,EAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU;SAC5C,CAAC,CAAC;QAEH,gBAAgB,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;IACnG,CAAC;IACL,4BAAC;AAAD,CAAC,AAvCD,IAuCC","sourcesContent":["import { ILoaderPlugin } from \"./loaderPlugin\";\r\nimport { telemetryManager } from \"../../managers/telemetryManager\";\r\nimport { ViewerModel } from \"../../model/viewerModel\";\r\nimport { ISceneLoaderPlugin, ISceneLoaderPluginAsync } from \"@babylonjs/core/Loading/sceneLoader\";\r\nimport { PrecisionDate } from \"@babylonjs/core/Misc/precisionDate\";\r\n\r\nexport class TelemetryLoaderPlugin implements ILoaderPlugin {\r\n\r\n    private _model: ViewerModel;\r\n\r\n    private _loadStart: number;\r\n    private _loadEnd: number;\r\n\r\n    public onInit(loader: ISceneLoaderPlugin | ISceneLoaderPluginAsync, model: ViewerModel) {\r\n        this._model = model;\r\n        this._loadStart = PrecisionDate.Now;\r\n    }\r\n\r\n    public onLoaded(model: ViewerModel) {\r\n        telemetryManager.broadcast(\"Model Loaded\", model.getViewerId(), {\r\n            model: model,\r\n            loadTime: PrecisionDate.Now - this._loadStart\r\n        });\r\n        telemetryManager.flushWebGLErrors(model.rootMesh.getEngine(), model.getViewerId());\r\n    }\r\n\r\n    public onError(message: string, exception: any) {\r\n        this._loadEnd = PrecisionDate.Now;\r\n        telemetryManager.broadcast(\"Load Error\", this._model.getViewerId(), {\r\n            model: this._model,\r\n            loadTime: this._loadEnd - this._loadStart\r\n        });\r\n\r\n        telemetryManager.flushWebGLErrors(this._model.rootMesh.getEngine(), this._model.getViewerId());\r\n    }\r\n\r\n    public onComplete() {\r\n        this._loadEnd = PrecisionDate.Now;\r\n        telemetryManager.broadcast(\"Load Complete\", this._model.getViewerId(), {\r\n            model: this._model,\r\n            loadTime: this._loadEnd - this._loadStart\r\n        });\r\n\r\n        telemetryManager.flushWebGLErrors(this._model.rootMesh.getEngine(), this._model.getViewerId());\r\n    }\r\n}"]}