{"version":3,"file":"templateManager.js","sourceRoot":"","sources":["../../../../sourceES6/viewer/src/templating/templateManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from '@babylonjs/core/Misc/observable';\r\nimport { Tools } from '@babylonjs/core/Misc/tools';\r\nimport { isUrl, camelToKebab, kebabToCamel } from '../helper';\r\n\r\nimport * as Handlebars from 'handlebars/dist/handlebars';\r\nimport { EventManager } from './eventManager';\r\nimport { ITemplateConfiguration } from '../configuration/interfaces';\r\nimport { deepmerge } from '../helper/';\r\nimport { IFileRequest } from '@babylonjs/core/Misc/fileRequest';\r\n\r\n/**\r\n * The object sent when an event is triggered\r\n */\r\nexport interface EventCallback {\r\n    event: Event;\r\n    template: Template;\r\n    selector: string;\r\n    payload?: any;\r\n}\r\n\r\n/**\r\n * The template manager, a member of the viewer class, will manage the viewer's templates and generate the HTML.\r\n * The template manager managers a single viewer and can be seen as the collection of all sub-templates of the viewer.\r\n */\r\nexport class TemplateManager {\r\n\r\n    /**\r\n     * Will be triggered when any template is initialized\r\n     */\r\n    public onTemplateInit: Observable<Template>;\r\n    /**\r\n     * Will be triggered when any template is fully loaded\r\n     */\r\n    public onTemplateLoaded: Observable<Template>;\r\n    /**\r\n     * Will be triggered when a template state changes\r\n     */\r\n    public onTemplateStateChange: Observable<Template>;\r\n    /**\r\n     * Will be triggered when all templates finished loading\r\n     */\r\n    public onAllLoaded: Observable<TemplateManager>;\r\n    /**\r\n     * Will be triggered when any event on any template is triggered.\r\n     */\r\n    public onEventTriggered: Observable<EventCallback>;\r\n\r\n    /**\r\n     * This template manager's event manager. In charge of callback registrations to native event types\r\n     */\r\n    public eventManager: EventManager;\r\n\r\n    private templates: { [name: string]: Template };\r\n\r\n    constructor(public containerElement: Element) {\r\n        this.templates = {};\r\n\r\n        this.onTemplateInit = new Observable<Template>();\r\n        this.onTemplateLoaded = new Observable<Template>();\r\n        this.onTemplateStateChange = new Observable<Template>();\r\n        this.onAllLoaded = new Observable<TemplateManager>();\r\n        this.onEventTriggered = new Observable<EventCallback>();\r\n\r\n        this.eventManager = new EventManager(this);\r\n    }\r\n\r\n    /**\r\n     * Initialize the template(s) for the viewer. Called bay the Viewer class\r\n     * @param templates the templates to be used to initialize the main template\r\n     */\r\n    public initTemplate(templates: { [key: string]: ITemplateConfiguration }) {\r\n\r\n        let internalInit = (dependencyMap, name: string, parentTemplate?: Template) => {\r\n            //init template\r\n            let template = this.templates[name];\r\n\r\n            let childrenTemplates = Object.keys(dependencyMap).map((childName) => {\r\n                return internalInit(dependencyMap[childName], childName, template);\r\n            });\r\n\r\n            // register the observers\r\n            //template.onLoaded.add(() => {\r\n            let addToParent = () => {\r\n                let lastElements = parentTemplate && parentTemplate.parent.querySelectorAll(camelToKebab(name));\r\n                let containingElement = (lastElements && lastElements.length && lastElements.item(lastElements.length - 1)) || this.containerElement;\r\n                template.appendTo(<HTMLElement>containingElement);\r\n                this._checkLoadedState();\r\n            };\r\n\r\n            if (parentTemplate && !parentTemplate.parent) {\r\n                parentTemplate.onAppended.add(() => {\r\n                    addToParent();\r\n                });\r\n            } else {\r\n                addToParent();\r\n            }\r\n            //});\r\n\r\n            return template;\r\n        };\r\n\r\n        //build the html tree\r\n        return this._buildHTMLTree(templates).then((htmlTree) => {\r\n            if (this.templates['main']) {\r\n                internalInit(htmlTree, 'main');\r\n            } else {\r\n                this._checkLoadedState();\r\n            }\r\n            return;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * This function will create a simple map with child-dependencies of the template html tree.\r\n     * It will compile each template, check if its children exist in the configuration and will add them if they do.\r\n     * It is expected that the main template will be called main!\r\n     *\r\n     * @param templates\r\n     */\r\n    private _buildHTMLTree(templates: { [key: string]: ITemplateConfiguration }): Promise<object> {\r\n        let promises: Array<Promise<Template | boolean>> = Object.keys(templates).map((name) => {\r\n            // if the template was overridden\r\n            if (!templates[name]) { return Promise.resolve(false); }\r\n            // else - we have a template, let's do our job!\r\n            let template = new Template(name, templates[name]);\r\n            template.onLoaded.add(() => {\r\n                this.onTemplateLoaded.notifyObservers(template);\r\n            });\r\n            template.onStateChange.add(() => {\r\n                this.onTemplateStateChange.notifyObservers(template);\r\n            });\r\n            this.onTemplateInit.notifyObservers(template);\r\n            // make sure the global onEventTriggered is called as well\r\n            template.onEventTriggered.add((eventData) => this.onEventTriggered.notifyObservers(eventData));\r\n            this.templates[name] = template;\r\n            return template.initPromise;\r\n        });\r\n\r\n        return Promise.all(promises).then(() => {\r\n            let templateStructure = {};\r\n            // now iterate through all templates and check for children:\r\n            let buildTree = (parentObject, name) => {\r\n                this.templates[name].isInHtmlTree = true;\r\n                let childNodes = this.templates[name].getChildElements().filter((n) => !!this.templates[n]);\r\n                childNodes.forEach((element) => {\r\n                    parentObject[element] = {};\r\n                    buildTree(parentObject[element], element);\r\n                });\r\n            };\r\n            if (this.templates['main']) {\r\n                buildTree(templateStructure, \"main\");\r\n            }\r\n            return templateStructure;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the canvas in the template tree.\r\n     * There must be one and only one canvas inthe template.\r\n     */\r\n    public getCanvas(): HTMLCanvasElement | null {\r\n        return this.containerElement.querySelector('canvas');\r\n    }\r\n\r\n    /**\r\n     * Get a specific template from the template tree\r\n     * @param name the name of the template to load\r\n     */\r\n    public getTemplate(name: string): Template | undefined {\r\n        return this.templates[name];\r\n    }\r\n\r\n    private _checkLoadedState() {\r\n        let done = Object.keys(this.templates).length === 0 || Object.keys(this.templates).every((key) => {\r\n            return (this.templates[key].isLoaded && !!this.templates[key].parent) || !this.templates[key].isInHtmlTree;\r\n        });\r\n\r\n        if (done) {\r\n            this.onAllLoaded.notifyObservers(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dispose the template manager\r\n     */\r\n    public dispose() {\r\n        // dispose all templates\r\n        Object.keys(this.templates).forEach((template) => {\r\n            this.templates[template].dispose();\r\n        });\r\n        this.templates = {};\r\n        this.eventManager.dispose();\r\n\r\n        this.onTemplateInit.clear();\r\n        this.onAllLoaded.clear();\r\n        this.onEventTriggered.clear();\r\n        this.onTemplateLoaded.clear();\r\n        this.onTemplateStateChange.clear();\r\n    }\r\n\r\n}\r\n\r\n// register a new helper. modified https://stackoverflow.com/questions/9838925/is-there-any-method-to-iterate-a-map-with-handlebars-js\r\nHandlebars.registerHelper('eachInMap', function(map, block) {\r\n    var out = '';\r\n    Object.keys(map).map(function(prop) {\r\n        let data = map[prop];\r\n        if (typeof data === 'object') {\r\n            data.id = data.id || prop;\r\n            out += block.fn(data);\r\n        } else {\r\n            out += block.fn({ id: prop, value: data });\r\n        }\r\n    });\r\n    return out;\r\n});\r\n\r\nHandlebars.registerHelper('add', function(a, b) {\r\n    var out = a + b;\r\n    return out;\r\n});\r\n\r\nHandlebars.registerHelper('eq', function(a, b) {\r\n    var out = (a == b);\r\n    return out;\r\n});\r\n\r\nHandlebars.registerHelper('or', function(a, b) {\r\n    var out = a || b;\r\n    return out;\r\n});\r\n\r\nHandlebars.registerHelper('not', function(a) {\r\n    var out = !a;\r\n    return out;\r\n});\r\n\r\nHandlebars.registerHelper('count', function(map) {\r\n    return map.length;\r\n});\r\n\r\nHandlebars.registerHelper('gt', function(a, b) {\r\n    var out = a > b;\r\n    return out;\r\n});\r\n\r\n/**\r\n * This class represents a single template in the viewer's template tree.\r\n * An example for a template is a single canvas, an overlay (containing sub-templates) or the navigation bar.\r\n * A template is injected using the template manager in the correct position.\r\n * The template is rendered using Handlebars and can use Handlebars' features (such as parameter injection)\r\n *\r\n * For further information please refer to the documentation page, https://doc.babylonjs.com\r\n */\r\nexport class Template {\r\n\r\n    /**\r\n     * Will be triggered when the template is loaded\r\n     */\r\n    public onLoaded: Observable<Template>;\r\n    /**\r\n     * will be triggered when the template is appended to the tree\r\n     */\r\n    public onAppended: Observable<Template>;\r\n    /**\r\n     * Will be triggered when the template's state changed (shown, hidden)\r\n     */\r\n    public onStateChange: Observable<Template>;\r\n    /**\r\n     * Will be triggered when an event is triggered on ths template.\r\n     * The event is a native browser event (like mouse or pointer events)\r\n     */\r\n    public onEventTriggered: Observable<EventCallback>;\r\n\r\n    public onParamsUpdated: Observable<Template>;\r\n\r\n    public onHTMLRendered: Observable<Template>;\r\n\r\n    /**\r\n     * is the template loaded?\r\n     */\r\n    public isLoaded: boolean;\r\n    /**\r\n     * This is meant to be used to track the show and hide functions.\r\n     * This is NOT (!!) a flag to check if the element is actually visible to the user.\r\n     */\r\n    public isShown: boolean;\r\n\r\n    /**\r\n     * Is this template a part of the HTML tree (the template manager injected it)\r\n     */\r\n    public isInHtmlTree: boolean;\r\n\r\n    /**\r\n     * The HTML element containing this template\r\n     */\r\n    public parent: HTMLElement;\r\n\r\n    /**\r\n     * A promise that is fulfilled when the template finished loading.\r\n     */\r\n    public initPromise: Promise<Template>;\r\n\r\n    private _fragment: DocumentFragment | Element;\r\n    private _addedFragment: DocumentFragment | Element;\r\n    private _htmlTemplate: string;\r\n    private _rawHtml: string;\r\n\r\n    private loadRequests: Array<IFileRequest>;\r\n\r\n    constructor(public name: string, private _configuration: ITemplateConfiguration) {\r\n        this.onLoaded = new Observable<Template>();\r\n        this.onAppended = new Observable<Template>();\r\n        this.onStateChange = new Observable<Template>();\r\n        this.onEventTriggered = new Observable<EventCallback>();\r\n        this.onParamsUpdated = new Observable<Template>();\r\n        this.onHTMLRendered = new Observable<Template>();\r\n\r\n        this.loadRequests = [];\r\n\r\n        this.isLoaded = false;\r\n        this.isShown = false;\r\n        this.isInHtmlTree = false;\r\n\r\n        let htmlContentPromise = this._getTemplateAsHtml(_configuration);\r\n\r\n        this.initPromise = htmlContentPromise.then((htmlTemplate) => {\r\n            if (htmlTemplate) {\r\n                this._htmlTemplate = htmlTemplate;\r\n                let compiledTemplate = Handlebars.compile(htmlTemplate, { noEscape: (this._configuration.params && !!this._configuration.params.noEscape) });\r\n                let config = this._configuration.params || {};\r\n                this._rawHtml = compiledTemplate(config);\r\n                try {\r\n                    this._fragment = document.createRange().createContextualFragment(this._rawHtml);\r\n                } catch (e) {\r\n                    let test = document.createElement(this.name);\r\n                    test.innerHTML = this._rawHtml;\r\n                    this._fragment = test;\r\n                }\r\n                this.isLoaded = true;\r\n                this.isShown = true;\r\n                this.onLoaded.notifyObservers(this);\r\n            }\r\n            return this;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Some templates have parameters (like background color for example).\r\n     * The parameters are provided to Handlebars which in turn generates the template.\r\n     * This function will update the template with the new parameters\r\n     *\r\n     * Note that when updating parameters the events will be registered again (after being cleared).\r\n     *\r\n     * @param params the new template parameters\r\n     */\r\n    public updateParams(params: { [key: string]: string | number | boolean | object }, append: boolean = true) {\r\n        if (append) {\r\n            this._configuration.params = deepmerge(this._configuration.params, params);\r\n        } else {\r\n            this._configuration.params = params;\r\n        }\r\n        // update the template\r\n        if (this.isLoaded) {\r\n            // this.dispose();\r\n        }\r\n        let compiledTemplate = Handlebars.compile(this._htmlTemplate);\r\n        let config = this._configuration.params || {};\r\n        this._rawHtml = compiledTemplate(config);\r\n        try {\r\n            this._fragment = document.createRange().createContextualFragment(this._rawHtml);\r\n        } catch (e) {\r\n            let test = document.createElement(this.name);\r\n            test.innerHTML = this._rawHtml;\r\n            this._fragment = test;\r\n        }\r\n        if (this.parent) {\r\n            this.appendTo(this.parent, true);\r\n        }\r\n    }\r\n\r\n    public redraw() {\r\n        this.updateParams({});\r\n    }\r\n\r\n    /**\r\n     * Get the template'S configuration\r\n     */\r\n    public get configuration(): ITemplateConfiguration {\r\n        return this._configuration;\r\n    }\r\n\r\n    /**\r\n     * A template can be a parent element for other templates or HTML elements.\r\n     * This function will deliver all child HTML elements of this template.\r\n     */\r\n    public getChildElements(): Array<string> {\r\n        let childrenArray: string[] = [];\r\n        //Edge and IE don't support frage,ent.children\r\n        let children: HTMLCollection | NodeListOf<Element> = this._fragment && this._fragment.children;\r\n        if (!this._fragment) {\r\n            let fragment = this.parent.querySelector(this.name);\r\n            if (fragment) {\r\n                children = fragment.querySelectorAll('*');\r\n            }\r\n        }\r\n        if (!children) {\r\n            // casting to HTMLCollection, as both NodeListOf and HTMLCollection have 'item()' and 'length'.\r\n            children = this._fragment.querySelectorAll('*');\r\n        }\r\n        for (let i = 0; i < children.length; ++i) {\r\n            const child = children.item(i);\r\n            if (child) {\r\n                childrenArray.push(kebabToCamel(child.nodeName.toLowerCase()));\r\n            }\r\n        }\r\n        return childrenArray;\r\n    }\r\n\r\n    /**\r\n     * Appending the template to a parent HTML element.\r\n     * If a parent is already set and you wish to replace the old HTML with new one, forceRemove should be true.\r\n     * @param parent the parent to which the template is added\r\n     * @param forceRemove if the parent already exists, shoud the template be removed from it?\r\n     */\r\n    public appendTo(parent: HTMLElement, forceRemove?: boolean) {\r\n        if (this.parent) {\r\n            if (forceRemove && this._addedFragment) {\r\n                /*let fragement = this.parent.querySelector(this.name)\r\n                if (fragement)\r\n                    this.parent.removeChild(fragement);*/\r\n                this.parent.innerHTML = '';\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n        this.parent = parent;\r\n\r\n        if (this._configuration.id) {\r\n            this.parent.id = this._configuration.id;\r\n        }\r\n        if (this._fragment) {\r\n            this.parent.appendChild(this._fragment);\r\n            this._addedFragment = this._fragment;\r\n        } else {\r\n            this.parent.insertAdjacentHTML(\"beforeend\", this._rawHtml);\r\n        }\r\n\r\n        this.onHTMLRendered.notifyObservers(this);\r\n\r\n        // appended only one frame after.\r\n        setTimeout(() => {\r\n            this._registerEvents();\r\n            this.onAppended.notifyObservers(this);\r\n        });\r\n    }\r\n\r\n    private _isShowing: boolean;\r\n    private _isHiding: boolean;\r\n\r\n    /**\r\n     * Show the template using the provided visibilityFunction, or natively using display: flex.\r\n     * The provided function returns a promise that should be fullfilled when the element is shown.\r\n     * Since it is a promise async operations are more than possible.\r\n     * See the default viewer for an opacity example.\r\n     * @param visibilityFunction The function to execute to show the template.\r\n     */\r\n    public show(visibilityFunction?: (template: Template) => Promise<Template>): Promise<Template> {\r\n        if (this._isHiding) { return Promise.resolve(this); }\r\n        return Promise.resolve().then(() => {\r\n            this._isShowing = true;\r\n            if (visibilityFunction) {\r\n                return visibilityFunction(this);\r\n            } else {\r\n                // flex? box? should this be configurable easier than the visibilityFunction?\r\n                this.parent.style.display = 'flex';\r\n                // support old browsers with no flex:\r\n                if (this.parent.style.display !== 'flex') {\r\n                    this.parent.style.display = '';\r\n                }\r\n                return this;\r\n            }\r\n        }).then(() => {\r\n            this.isShown = true;\r\n            this._isShowing = false;\r\n            this.onStateChange.notifyObservers(this);\r\n            return this;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Hide the template using the provided visibilityFunction, or natively using display: none.\r\n     * The provided function returns a promise that should be fullfilled when the element is hidden.\r\n     * Since it is a promise async operations are more than possible.\r\n     * See the default viewer for an opacity example.\r\n     * @param visibilityFunction The function to execute to show the template.\r\n     */\r\n    public hide(visibilityFunction?: (template: Template) => Promise<Template>): Promise<Template> {\r\n        if (this._isShowing) { return Promise.resolve(this); }\r\n        return Promise.resolve().then(() => {\r\n            this._isHiding = true;\r\n            if (visibilityFunction) {\r\n                return visibilityFunction(this);\r\n            } else {\r\n                // flex? box? should this be configurable easier than the visibilityFunction?\r\n                this.parent.style.display = 'none';\r\n                return this;\r\n            }\r\n        }).then(() => {\r\n            this.isShown = false;\r\n            this._isHiding = false;\r\n            this.onStateChange.notifyObservers(this);\r\n            return this;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Dispose this template\r\n     */\r\n    public dispose() {\r\n        this.onAppended.clear();\r\n        this.onEventTriggered.clear();\r\n        this.onLoaded.clear();\r\n        this.onStateChange.clear();\r\n        this.isLoaded = false;\r\n        // remove from parent\r\n        try {\r\n            this.parent.removeChild(this._fragment);\r\n        } catch (e) {\r\n            //noop\r\n        }\r\n\r\n        this.loadRequests.forEach((request) => {\r\n            request.abort();\r\n        });\r\n\r\n        if (this._registeredEvents) {\r\n            this._registeredEvents.forEach((evt) => {\r\n                evt.htmlElement.removeEventListener(evt.eventName, evt.function);\r\n            });\r\n        }\r\n\r\n        delete this._fragment;\r\n    }\r\n\r\n    private _getTemplateAsHtml(templateConfig: ITemplateConfiguration): Promise<string> {\r\n        if (!templateConfig) {\r\n            return Promise.reject('No templateConfig provided');\r\n        } else if (templateConfig.html && !templateConfig.location) {\r\n            return Promise.resolve(templateConfig.html);\r\n        } else {\r\n            let location = this._getTemplateLocation(templateConfig);\r\n            if (isUrl(location)) {\r\n                return new Promise((resolve, reject) => {\r\n                    let fileRequest = Tools.LoadFile(location, (data: string) => {\r\n                        resolve(data);\r\n                    }, undefined, undefined, false, (request, error: any) => {\r\n                        reject(error);\r\n                    });\r\n                    this.loadRequests.push(fileRequest);\r\n                });\r\n            } else {\r\n                location = location.replace('#', '');\r\n                let element = document.getElementById(location);\r\n                if (element) {\r\n                    return Promise.resolve(element.innerHTML);\r\n                } else {\r\n                    return Promise.reject('Template ID not found');\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _registeredEvents: Array<{ htmlElement: HTMLElement, eventName: string, function: EventListenerOrEventListenerObject }>;\r\n\r\n    private _registerEvents() {\r\n        this._registeredEvents = this._registeredEvents || [];\r\n        if (this._registeredEvents.length) {\r\n            // first remove the registered events\r\n            this._registeredEvents.forEach((evt) => {\r\n                evt.htmlElement.removeEventListener(evt.eventName, evt.function);\r\n            });\r\n        }\r\n        if (this._configuration.events) {\r\n            for (let eventName in this._configuration.events) {\r\n                if (this._configuration.events && this._configuration.events[eventName]) {\r\n                    let functionToFire = (selector, event) => {\r\n                        this.onEventTriggered.notifyObservers({ event: event, template: this, selector: selector });\r\n                    };\r\n\r\n                    // if boolean, set the parent as the event listener\r\n                    if (typeof this._configuration.events[eventName] === 'boolean') {\r\n                        let selector = this.parent.id;\r\n                        if (selector) {\r\n                            selector = '#' + selector;\r\n                        } else {\r\n                            selector = this.parent.tagName;\r\n                        }\r\n                        let binding = functionToFire.bind(this, selector);\r\n                        this.parent.addEventListener(eventName, functionToFire.bind(this, selector), false);\r\n                        this._registeredEvents.push({\r\n                            htmlElement: this.parent,\r\n                            eventName: eventName,\r\n                            function: binding\r\n                        });\r\n                    } else if (typeof this._configuration.events[eventName] === 'object') {\r\n                        let selectorsArray: Array<string> = Object.keys((this._configuration.events[eventName] as object) || {});\r\n                        // strict null checl is working incorrectly, must override:\r\n                        let event = this._configuration.events[eventName] || {};\r\n                        selectorsArray.filter((selector) => event[selector]).forEach((selector) => {\r\n                            let htmlElement = <HTMLElement>this.parent.querySelector(selector);\r\n                            if (!htmlElement) {\r\n                                // backcompat, fallback to id\r\n                                if (selector && selector.indexOf('#') !== 0) {\r\n                                    selector = '#' + selector;\r\n                                }\r\n                                try {\r\n                                    htmlElement = <HTMLElement>this.parent.querySelector(selector);\r\n                                } catch (e) { }\r\n                            }\r\n                            if (htmlElement) {\r\n                                let binding = functionToFire.bind(this, selector);\r\n                                htmlElement.addEventListener(eventName, binding, false);\r\n                                this._registeredEvents.push({\r\n                                    htmlElement: htmlElement,\r\n                                    eventName: eventName,\r\n                                    function: binding\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _getTemplateLocation(templateConfig): string {\r\n        if (!templateConfig || typeof templateConfig === 'string') {\r\n            return templateConfig;\r\n        } else {\r\n            return templateConfig.location;\r\n        }\r\n    }\r\n}"]}